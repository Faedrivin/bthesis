\documentclass[Thesis.tex]{subfiles}
\begin{document}

\chapter{Augmented Monte Carlo Localization in six dimensions}

\section{The algorithm}

\begin{algorithm}

\caption{AMCL6D}
\label{alg:amcl6d}

\SetKwFunction{mm}{motion\mathunderscore model}
\SetKwFunction{sm}{sensor\mathunderscore model}
\SetKwFunction{kd}{prepare\mathunderscore kd\mathunderscore tree}
\SetKwFunction{ev}{evaluation}
\SetKwFunction{rsrand}{resample\mathunderscore random}
\SetKwFunction{rsclose}{resample\mathunderscore close}
\SetKwFunction{sort}{sort}
\SetKwFunction{rand}{rand}
\SetKwData{rval}{random}

\SetKwProg{amcl}{AMCL6D}{}{end}

\amcl{$(X_{t-1}, u_{t}, m_{t})$} {

\BlankLine

\tcc{Initialize}
$k_t$ = \kd{$m_{t}$}
$X_t$ = $X_{t-1}$\;

\BlankLine

\tcc{Update motion and sensor model}
\ForAll{$x \in X_{t}$}{ 
  $x.pose$ = \mm{$x.pose, u_{t}$}\;
  $x.raytrace$ = \sm{$x$}\;
  $x.likelihood$ = \ev{$k_t, x.raytrace$}\;
}

\BlankLine

\tcc{Find normalization constant $\eta$}
$\eta = \frac{1}{ \sum\limits_{X_{t}}{\left( x.likelihood\ \cdot\ x.probability\right) } }$\;

\BlankLine

\tcc{Calculate posterior probabilities}
\ForAll{$x \in X_{t}$}{
  $x.probability = \eta \cdot x.likelihood\ \cdot\ x.probability$\;
}

\BlankLine

\tcc{Resampling}
\sort{$X_{t}$}\;

\ForAll{$x \in X_{t}$}{
  \rval = \rand{}\;
  \uIf{\rval $< \theta_{rand}$}{
    $x$ = \rsrand{}\;
  }
  \uElseIf{\rval $< \theta_{close}$}{
    $x$ = \rsclose{$x, X_t$}\;
  }
  \ElseIf{$x.probability < \theta_{prob}$}{
    $x$ = \rsrand{}\;
  }
}

\Return{$X_t$}

\BlankLine
}

\end{algorithm}

$m_{t}$ = robot sensor input

$u_{t}$ = robot motion (measured)

$X_{t-1}$ = samples at time t-1

$X_{t}$ = samples at time t

$x$ = sample (contains: pose, likelihood, probability, raytrace)

$k_{t}$ = kd tree

$\theta$ = threshold
The algorithm \ref{alg:amcl6d} is beautiful.

\begin{algorithm}
\caption{Sample evaluation}
\label{alg:eval}

\SetKwProg{ev}{evaluation}{}{end}
\ev{}{
}
\end{algorithm}


\end{document}